---
- name: Setup for mariadb

  become: true

  hosts: mariadb

  vars_files:
    - vars/mariadb_secrets.yaml
    - ../vars/main.yaml

  roles:
    - user
    - common

  tasks:
    - name: Install mariadb
      tags: mariadb
      apt:
        name:
          - mariadb-server-10.6
          - python3
          - python3-mysqldb
        state: latest

    - name: Configure users
      tags: mariadb
      mysql_user:
        name: "{{ item.username }}"
        password: "{{ item.password }}"
        priv: '*.*:ALL,GRANT'
        state: present
      loop: "{{ mariadb_users }}"
      loop_control:
        label: "{{ item.username }}"
