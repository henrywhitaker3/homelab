kind: pipeline
type: docker
name: docker playbook

steps:
- name: docker playbook
  image: henrywhitaker3/ansible-terraform
  when:
    branch:
      - main
  environment:
    SSH_KEY:
      from_secret: HOMELAB_SSH_KEY
    SSH_PUBKEY:
      from_secret: HOMELAB_SSH_PUBKEY
    KNOWN_HOSTS:
      from_secret: HOMELAB_KNOWN_HOSTS
  commands:
    - echo -e $SSH_KEY > ~/.ssh/id_rsa
    - chmod 600 ~/.ssh/id_rsa
    - echo -e $SSH_PUBKEY > ~/.ssh/id_rsa.pub
    - echo -e $KNOWN_HOSTS > ~/.ssh/known_hosts
    - ssh henry@10.0.0.160 echo $(whoami)@$(hostname) $(pwd)
