version: '3.9'
services:
    #-------------------------------------------#
    # Media services
    #-------------------------------------------#
    plex:
      container_name: plex
      image: linuxserver/plex:latest
      network_mode: host
      environment:
        - PUID={{ docker_puid }}
        - PGID={{ docker_puid }}
        - TZ={{ docker_tz }}
        - VERSION=latest
      devices:
        - /dev/dri:/dev/dri
      volumes:
        - {{ docker_data_dir}}/plex:/config
        - /plex:/plex
      restart: unless-stopped
      cpus: 8

    #-------------------------------------------#
    # General services
    #-------------------------------------------#
    swag:
      container_name: swag
      restart: unless-stopped
      image: linuxserver/swag:latest
      ports:
        - 443:443
        - 80:80
      volumes:
        - {{ docker_data_dir }}/swag:/config
        - {{ docker_data_dir }}/organizr:/organizr:ro
      environment:
        - PUID={{ docker_puid }}
        - PGID={{ docker_puid }}
        - TZ={{ docker_tz }}
        - URL=plexmox.com
        - SUBDOMAINS=wildcard
        - VALIDATION=dns
        - DNSPLUGIN=cloudflare
        - ONLY_SUBDOMAINS=false
        - MAXMINDDB_LICENSE_KEY={{ maxmind_license_key }}
      cap_add: [ 'NET_ADMIN' ]
      networks:
        homelab:

networks:
    homelab:
    monitoring:
