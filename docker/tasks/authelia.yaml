---
- name: Ensure authelia dirs exists
  tags:
    - authelia
  become: true
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    owner: root
    group: root
    mode: "0755"
  loop:
    - "{{ docker_data_dir }}/authelia"
    - "{{ docker_data_dir }}/authelia/logs"

- name: Copy authelia config over
  tags:
    - authelia
  become: true
  ansible.builtin.template:
    src: templates/authelia.yaml
    dest: "{{ docker_data_dir }}/authelia/configuration.yml"
    mode: "0600"
    owner: root
    group: root
  notify: restart authelia

- name: Copy authelia users over
  tags:
    - authelia
  become: true
  ansible.builtin.template:
    src: templates/authelia_users.yaml
    dest: "{{ docker_data_dir }}/authelia/users_database.yml"
    mode: "0600"
    owner: root
    group: root
  notify: restart authelia

- name: debug
  debug:
    msg: "hello here"
