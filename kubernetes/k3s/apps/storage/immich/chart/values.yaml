controllers:
  main:
    containers:
      main:
        image:
          # renovate: datasource=github-releases depName=immich-app/immich
          tag: v2.5.2

valkey:
  enabled: false

immich:
  metrics:
    enabled: true
  persistence:
    library:
      existingClaim: immich

server:
  controllers:
    main:
      strategy: Recreate
      containers:
        main:
          env:
            REDIS_HOSTNAME: dragonfly.dragonfly.svc.cluster.local
            DB_VECTOR_EXTENSION: pgvector
            DB_HOSTNAME:
              valueFrom:
                secretKeyRef:
                  name: crunchy-pguser-immich
                  key: host
            DB_USERNAME:
              valueFrom:
                secretKeyRef:
                  name: crunchy-pguser-immich
                  key: user
            DB_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: crunchy-pguser-immich
                  key: password
            DB_DATABASE_NAME:
              valueFrom:
                secretKeyRef:
                  name: crunchy-pguser-immich
                  key: dbname
            TZ: Europe/London
  route:
    main:
      enabled: true
      hostnames: [immich.plexmox.com]
      kind: HTTPRoute
      parentRefs:
        - group: gateway.networking.k8s.io
          kind: Gateway
          name: internal
          namespace: traefik
      rules:
        - backendRefs:
            - kind: Service
              name: immich-server
              namespace: immich
              port: 2283
          matches:
            - path:
                type: PathPrefix
