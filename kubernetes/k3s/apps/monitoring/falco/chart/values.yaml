falco:
  metrics:
    enabled: true
    interval: "5m"

  serviceMonitor:
    create: true

  falcosidekick:
    enabled: false
    webui:
      enabled: false

      redis:
        enabled: false

      externalRedis:
        enabled: true
        port: 6379
        url: dragonfly.dragonfly.svc.cluster.local

  grafana:
    dashboards:
      enabled: true
      configMaps:
        falco:
          folder: Falco
          name: falco-grafana-dashboard

  collectors:
    containerd:
      enabled: false
      socket: /run/k3s/containerd/containerd.sock

  customRules:
    default.yaml: |
      - rule: Contact K8S API Server From Container
        override:
          exceptions: append
        exceptions:
          - name: operators
            fields: [container.image.repository]
            comps: [=]
            values:
              - [docker.io/kiwigrid/k8s-sidecar]
              - [quay.io/kiwigrid/k8s-sidecar]
              - [registry.developers.crunchydata.com/crunchydata/postgres-operator]
              - [quay.io/argoproj/argocd]
              - [registry.k8s.io/ingress-nginx/controller]
              - [docker.io/longhornio/longhorn-manager]
              - [registry.developers.crunchydata.com/crunchydata/crunchy-postgres]
              - [oci.external-secrets.io/external-secrets/external-secrets]
              - [ghcr.io/synthetigo/api]
              - [registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest]
              - [registry.k8s.io/kube-state-metrics/kube-state-metrics]
              - [registry.gitlab.com/gitlab-org/gitlab-runner]
          - name: redeployer
            fields: [container.image.repository, k8s.ns.name, k8s.pod.name]
            comps: [=, =, startswith]
            values:
              - [docker.io/bitnami/kubectl, media, redeployer]
      - rule: Notice Redirect stdout/stdin to network connection
        override:
          exceptions: append
        exceptions:
          - name: longhorn
            fields: [container.image.repository, k8s.ns.name]
            cmps: [=, =]
            values:
              - [docker.io/longhornio/longhorn-manager, longhorn-system]
      - rule: Notice Shell spawned by untrusted binary
        override:
          exceptions: append
        exceptions:
          - name: pgo
            fields: [k8s.ns.name, container.image.repository, proc.pname]
            cmps: [=, =]
            values:
              - [crunchy, registry.developers.crunchydata.com/crunchydata/crunchy-postgres, postgres]
