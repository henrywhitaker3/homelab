---
crowdsec:
  container_runtime: containerd
  tls:
    enabled: true
  agent:
    metrics:
      serviceMonitor:
        enabled: true
    acquisition:
      - namespace: traefik
        podName: traefik-public-*
        program: traefik
    env:
      - name: PARSERS
        value: "crowdsecurity/cri-logs"
      - name: COLLECTIONS
        value: "crowdsecurity/traefik"
      - name: DISABLE_PARSERS
        value: "crowdsecurity/whitelists"
    persistentVolume:
      config:
        enabled: false

  lapi:
    replicas: 3
    storeCAPICredentialsInSecret: true
    persistentVolume:
      config:
        enabled: false
      data:
        enabled: false
    dashboard:
      enabled: false
      ingress:
        enabled: false
    metrics:
      serviceMonitor:
        enabled: true
    env:
      - name: DISABLE_ONLINE_API
        value: "true"
      - name: ENROLL_KEY
        valueFrom:
          secretKeyRef:
            name: crowdsec-secrets
            key: enroll-key
      - name: ENROLL_INSTANCE_NAME
        value: "k3s"

  secrets:
    externalSecret:
      name: crowdsec-secrets
      csLapiSecretKey: cs-lapi-secret
      registrationTokenKey: registration-token
