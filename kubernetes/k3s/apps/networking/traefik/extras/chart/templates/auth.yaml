{{- range .Values.middlewares.authelia.namespaces }}
---
# yaml-language-server: $schema=https://github.com/datreeio/CRDs-catalog/raw/refs/heads/main/traefik.io/middleware_v1alpha1.json
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: auth-internal
  namespace: "{{ . }}"
  labels:
    traefik-instance: internal
spec:
  forwardAuth:
    address: http://authelia.authelia.svc.cluster.local/api/authz/forward-auth
    trustForwardHeader: true
    authResponseHeaders:
      - "Remote-User"
      - "Remote-Groups"
      - "Remote-Email"
      - "Remote-Name"
---
# yaml-language-server: $schema=https://github.com/datreeio/CRDs-catalog/raw/refs/heads/main/traefik.io/middleware_v1alpha1.json
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: auth-public
  namespace: "{{ . }}"
  labels:
    traefik-instance: public
spec:
  forwardAuth:
    address: http://authelia.authelia.svc.cluster.local/api/authz/forward-auth
    trustForwardHeader: true
    authResponseHeaders:
      - "Remote-User"
      - "Remote-Groups"
      - "Remote-Email"
      - "Remote-Name"
{{- end }}
{{- range .Values.middlewares.organizr.namespaces }}
---
# yaml-language-server: $schema=https://github.com/datreeio/CRDs-catalog/raw/refs/heads/main/traefik.io/middleware_v1alpha1.json
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: organizr-auth-public
  namespace: "{{ . }}"
  labels:
    traefik-instance: public
spec:
  forwardAuth:
    address: https://plexmox.com/api/v2/auth?group=1
---
# yaml-language-server: $schema=https://github.com/datreeio/CRDs-catalog/raw/refs/heads/main/traefik.io/middleware_v1alpha1.json
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: organizr-user-auth-public
  namespace: "{{ . }}"
  labels:
    traefik-instance: public
spec:
  forwardAuth:
    address: https://plexmox.com/api/v2/auth?group=4
{{- end }}
