global:
  domain: argocd.plexmox.com

argo-cd:
  dex:
    enabled: false

  controller:
    args:
      appResyncPeriod: 60
    metrics:
      enabled: true
      service:
        annotations:
          prometheus.io/scrape: true
          prometheus.io/path: /metrics
          prometheus.io/port: 8082

  server:
    ingress:
      enabled: true
      annotations:
        kubernetes.io/tls-acme: "true"
        cert-manager.io/cluster-issuer: letsencrypt-prod
        nginx.ingress.kubernetes.io/ssl-passthrough: "true"
        nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
        nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
        nginx.ingress.kubernetes.io/auth-method: "GET"
        nginx.ingress.kubernetes.io/auth-url: "https://auth.plexmox.com/api/authz/auth-request"
        nginx.ingress.kubernetes.io/auth-signin: "https://auth.plexmox.com?rm=$request_method"
        nginx.ingress.kubernetes.io/auth-response-headers: "Remote-User,Remote-Name,Remote-Groups,Remote-Email"
      ingressClassName: "nginx"

      extraTls:
        - hosts:
            - argocd.plexmox.com
          secretName: argocd-plexmox-com

      hosts:
        - argocd.plexmox.com
    config:
      url: https://argocd.plexmox.com
      repositories: |
        - type: helm
          name: stable
          url: https://charts.helm.sh/stable
        - type: helm
          name: argo-cd
          url: https://argoproj.github.io/argo-helm
      resource.exclusions: |
        - apiGroups:
            - cilium.io
          kinds:
            - CiliumIdentity
          clusters:
            - '*'

    metrics:
      enabled: true
      service:
        annotations:
          prometheus.io/scrape: true
          prometheus.io/path: /metrics
          prometheus.io/port: 8083

  repoServer:
    metrics:
      enabled: true
      service:
        annotations:
          prometheus.io/scrape: true
          prometheus.io/path: /metrics
          prometheus.io/port: 8084

  applicationSet:
    metrics:
      enabled: true
      service:
        annotations:
          prometheus.io/scrape: true
          prometheus.io/path: /metrics
          prometheus.io/port: 8080

  configs:
    cm:
      kustomize.buildOptions: --enable-helm
      accounts.readonly: apiKey
      # resource.exclusions: |
      #   - apiGroups:
      #     - ''
      #     - discovery.k8s.io
      #     kinds:
      #     - EndpointSlice
      #   ### Internal Kubernetes resources excluded reduce the number of watched events
      #   - apiGroups:
      #     - coordination.k8s.io
      #     kinds:
      #     - Lease
      #   ### Internal Kubernetes Authz/Authn resources excluded reduce the number of watched events
      #   - apiGroups:
      #     - authentication.k8s.io
      #     - authorization.k8s.io
      #     kinds:
      #     - SelfSubjectReview
      #     - TokenReview
      #     - LocalSubjectAccessReview
      #     - SelfSubjectAccessReview
      #     - SelfSubjectRulesReview
      #     - SubjectAccessReview
      #   ### Intermediate Certificate Request excluded reduce the number of watched events
      #   - apiGroups:
      #     - certificates.k8s.io
      #     kinds:
      #     - CertificateSigningRequest
      #   - apiGroups:
      #     - cert-manager.io
      #     kinds:
      #     - CertificateRequest
      #   ### Cilium internal resources excluded reduce the number of watched events and UI Clutter
      #   - apiGroups:
      #     - cilium.io
      #     kinds:
      #     - CiliumIdentity
      #     - CiliumEndpoint
      #     - CiliumEndpointSlice
      #   ### Kyverno intermediate and reporting resources excluded reduce the number of watched events and improve performance
      #   - apiGroups:
      #     - kyverno.io
      #     - reports.kyverno.io
      #     - wgpolicyk8s.io
      #     kinds:
      #     - PolicyReport
      #     - ClusterPolicyReport
      #     - EphemeralReport
      #     - ClusterEphemeralReport
      #     - AdmissionReport
      #     - ClusterAdmissionReport
      #     - BackgroundScanReport
      #     - ClusterBackgroundScanReport
      #     - UpdateRequest
    rbac:
      policy.csv: "g, readonly, role:readonly"
