projects:
  - name: cluster
    description: Things that make the cluster work
  - name: apps
    description: Our apps running in the cluster

charts:
  - name: metallb
    project: cluster
    namespace: metallb
    path: metallb
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: ingress-nginx
    project: cluster
    namespace: ingress-nginx
    chart: ingress-nginx
    repoUrl: https://kubernetes.github.io/ingress-nginx
    targetRevision: 4.6.1
    values:
      controller:
        kind: DaemonSet
        watchIngressWithoutClass: true
        config:
          proxy-real-ip-cidr: "173.245.48.0/20,103.21.244.0/22,103.22.200.0/22,103.31.4.0/22,141.101.64.0/18,108.162.192.0/18,190.93.240.0/20,188.114.96.0/20,197.234.240.0/22,198.41.128.0/17,162.158.0.0/15,104.16.0.0/12,172.64.0.0/13,131.0.72.0/22,2400:cb00::/32,2606:4700::/32,2803:f800::/32,2405:b500::/32,2405:8100::/32,2a06:98c0::/29,2c0f:f248::/32,10.0.0.0/8"
          server-snippet: |
            real_ip_header CF-Connecting-IP;
          use-proxy-protocol: true
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: cert-manager
    project: cluster
    namespace: cert-manager
    path: cert-manager
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: longhorn
    project: cluster
    namespace: longhorn
    chart: longhorn
    repoUrl: https://charts.longhorn.io
    values:
      ingress:
        enabled: true
        host: longhorn.plexmox.com
        tls: true
        tlsSecret: longhorn-plexmox-com-tls
        annotations:
          kubernetes.io/tls-acme: "true"
          cert-manager.io/cluster-issuer: letsencrypt-prod
          nginx.ingress.kubernetes.io/auth-url: https://auth.plexmox.com/api/verify
          nginx.ingress.kubernetes.io/auth-signin: https://auth.plexmox.com
    targetRevision: 1.4.1
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: gitlab-runner
    project: apps
    namespace: gitlab-runner
    chart: gitlab-runner
    repoUrl: https://charts.gitlab.io
    targetRevision: 0.52.0
    values:
      concurrent: 10
      gitlabUrl: https://gitlab.com
      runners:
        secret: gitlab-runner-secret
      rbac:
        create: true
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: descheduler
    project: cluster
    namespace: kube-system
    chart: descheduler
    repoUrl: https://kubernetes-sigs.github.io/descheduler
    targetRevision: 0.26.1
    values:
      schedule: "*/5 * * * *"
      deschedulerPolicy:
        strategies:
          LowNodeUtilization:
            params:
              nodeResourceUtilizationThresholds:
                thresholds:
                  cpu: 20
                  memory: 20
                  pods: 10
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: connect
    project: cluster
    namespace: 1password
    chart: connect
    repoUrl: https://1password.github.io/connect-helm-charts
    targetRevision: 1.10.0
    values:
      operator:
        create: true
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: smb-provisioner
    project: cluster
    namespace: kube-system
    chart: csi-driver-smb
    repoUrl: https://raw.githubusercontent.com/kubernetes-csi/csi-driver-smb/master/charts
    targetRevision: 1.9.0
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: smb-storage-class
    project: cluster
    namespace: kube-system
    path: smb
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    values:
      creds:
        secretName: smb-creds
        namespace: kube-system
      host: //10.0.0.9/pvcs
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: misc
    project: cluster
    namespace: default
    path: misc
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: sonarr
    project: apps
    namespace: media
    path: sonarr
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: radarr
    project: apps
    namespace: media
    path: radarr
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: overseerr
    project: apps
    namespace: media
    path: overseerr
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: organizr
    project: apps
    namespace: media
    path: organizr
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: prowlarr
    project: apps
    namespace: media
    path: prowlarr
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: tautulli
    project: apps
    namespace: media
    path: tautulli
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: monitorr
    project: apps
    namespace: media
    path: monitorr
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: false

  - name: speedtest
    project: apps
    namespace: misc
    path: speedtest
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: transmission
    project: apps
    namespace: media
    path: transmission
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: redis
    project: apps
    namespace: databases
    path: redis
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: mariadb
    project: apps
    namespace: databases
    path: mariadb
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: authelia
    project: apps
    namespace: authelia
    path: authelia
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: kube-prometheus-stack
    project: apps
    namespace: monitoring
    path: prometheus
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: plex
    project: apps
    namespace: media
    path: plex
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  - name: redeployer
    project: cluster
    namespace: media
    path: redeployer
    repoUrl: https://gitlab.com/henrywhitaker3/charts.git
    targetRevision: HEAD
    syncPolicy:
      syncOptions:
        - CreateNamespace=true
      automated:
        prune: true
        selfHeal: true

  # - name: rancher
  #   project: cluster
  #   namespace: cattle-system
  #   chart: rancher
  #   repoUrl: https://releases.rancher.com/server-charts/stable
  #   targetRevision: 2.7.3
  #   values:
  #     hostname: rancher.plexmox.com
  #     ingress:
  #       tls:
  #         source: letsEncrypt
  #     letsEncrypt:
  #       email: no-reply@plexmox.com
  #   syncPolicy:
  #     syncOptions:
  #       - CreateNamespace=true
  #     automated:
  #       prune: true
  #       selfHeal: true
