{{- range $range := .Values.clusters }}
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: {{ $range.name }}
spec:
  instances: {{ $range.instances | default 3 }}
  primaryUpdateStrategy: {{ $range.primaryUpdateStrategy | default "unsupervised" }}
  storage:
    size: {{ $range.storage.size | default "1Gi" }}
    storageClass: {{ $range.storage.size | default "longhorn" }}
  monitoring:
    enabledPodMonitor: {{ $range.monitoring.enabled | default true }}
  superuserSecret:
    name: {{ $range.name }}
---
apiVersion: onepassword.com/v1
kind: OnePasswordItem
metadata:
  name: {{ $range.name }}
spec:
  itemPath: {{ $range.secret }}
---
{{- end }}
