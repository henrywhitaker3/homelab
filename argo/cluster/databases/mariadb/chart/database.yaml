apiVersion: k8s.mariadb.com/v1alpha1
kind: MariaDB
metadata:
  name: mariadb
  annotations:
    argocd.argoproj.io/sync-wave: "5"
spec:
  port: 3306

  replicas: 5 # set to the number of nodes in the cluster

  galera:
    enabled: true
    config:
      reuseStorageVolume: true
    recovery:
      enabled: true

  podSecurityContext:
    runAsUser: 0

  rootPasswordSecretKeyRef:
    name: mariadb-secrets
    key: root-password

  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: "kubernetes.io/hostname"
      whenUnsatisfiable: "DoNotSchedule"
      labelSelector:
        matchLabels:
          app.kubernetes.io/instance: mariadb

  storage:
    volumeClaimTemplate:
      storageClassName: openebs-hostpath
      resources:
        requests:
          storage: 6Gi
      accessModes:
        - ReadWriteOnce

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 300m
      memory: 512Mi

  metrics:
    enabled: true

  service:
    type: LoadBalancer
    loadBalancerIP: 10.0.0.28
