apiVersion: v1
kind: ConfigMap
metadata:
  name: loki-rules
data:
  srep-ui.yaml: |
    groups:
      - name: ui
        interval: 1m
        rules:
          - record: srep_ui_requests_total
            expr: |
              sum(
                rate({app="srep-ui-chart"} |= `` | pattern `<_> - - <_> "<method> <url> <_>" <status> <size> <_> "<agent>" "<ip>"` [1m])
              ) by(job, status, url, method, container, pod, instance)
